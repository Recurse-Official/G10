<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Profile</title>  
  <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
  <link rel="stylesheet"  href="/homecss">
  <!-- Boxicons -->
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<!-- My CSS -->

  <script src=
  "https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js">
      </script>
</head>
<body>
  
<!-- Sidebar -->
<div class="sidebar">
  <a href="/home" class="logo">
      <i class='bx bx-code-alt'></i>
      <div class="logo-name"><span>CampusCurrency</div>
  </a>
  <ul class="side-menu">
      <li><a href="/home"><i class='bx bxs-dashboard'></i>Dashboard</a></li>
      <li>
          <a href="/profile">
    <i class='bx bx-user-circle'></i>
              <span class="text">Profile</span>
          </a>
      </li>
      <li>
          <a href="/connections">
              <i class='bx bxs-doughnut-chart' ></i>
              <span class="text">Transactions</span>
          </a>
      </li>
  </ul>
  <ul class="side-menu">
    <li>
        <a href="/logout" class="logout">
          <i class='bx bx-power-off' ></i>
            <span class="text">Logout</span>
        </a>
    </li>
  </ul>
</div>
<!-- End of Sidebar -->

<!-- Main Content -->
<div class="content">
  <!-- Navbar -->
  <nav>
    <i class='bx bx-menu'></i>
    <form action="#">
        <div class="form-input">
            <input type="search" placeholder="Search...">
            <button class="search-btn" type="submit"><i class='bx bx-search'></i></button>
        </div>
    </form>
    <a href="/connections" class="notif">
        <i class='bx bx-bell'></i>
    </a>
    <!-- New QR Scanner Button -->
    <button id="scanQrBtn" class="qr-btn">
        <i class='bx bx-qr-scan'></i> Scan QR
    </button>
    <a href="/profile" class="profile">
        <img src="images/logo.png">
    </a>
</nav>

  <!-- End of Navbar -->

  <main>
      <div class="header">
          <div class="left">
            <h1>
              <p><li></i>Welcome
              <a href="/profile"><span id="fname">Loading...</span> <span id="lname"></span></a>!</p>
            </li></h1>
                      <ul class="breadcrumb">
                          <li>
                              <a href="#">Dashboard</a>
                          </li>
                          <li><i class='bx bx-chevron-right' ></i></li>
                          <li>
                              <a class="active" href="/home">Profile</a>
                          </li>
                      </ul>
          </div>
      </div>

      <!-- Insights -->
      <ul class="insights">
        <li>
          <i class='bx bx-receipt'></i>
          <span class="text">
              <h3>Balance</h3>
              <p id="balance">1</p>
          </span>
        </li>


        <li>
          <i class='bx bx-receipt'></i>
          <span class="text">
              <h3>Profile QRCode</h3>
              
               <div id="qrcode"></div>
          </span>
        </li>
    </ul>


          
      </ul>
      <!-- End of Insights -->
      
      <div class="bottom-data">
        <div class="orders">
            <div class="header">
                <i class='bx bx-receipt'></i>
                <h3>Details</h3>
            </div>
            <table>
              <thead>
                <tr>
                  <!-- Category column heading -->
                  <th>Category</th>
                  <!-- Details column heading -->
                  <th>Details</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <!-- Name row -->
                  <td>Name:</td>
                  <td><span id="fname2">Loading...</span> <span id="lname2"></span></td>
                </tr>
                <tr>
                  <!-- Email row -->
                  <td>Email:</td>
                  <td><span id="email">Loading...</span></td>
                </tr>
                <tr>
                  <!-- Roll Number row -->
                  <td>Roll Number:</td>
                  <td><span id="rollno">Loading...</span></td>
                </tr>
                <tr>
                  <!-- Address row -->
                  <td>Address:</td>
                  <td><span id="address">Loading...</span></td>
                </tr>
                <tr>
                  <!-- Balance row -->
                  <td>Balance:</td>
                  <td><span id="balance2">Loading...</span></td>
                </tr>
              </tbody>
            </table>
            
            
        </div>

      
      
      <div class="main_content">
        <div class="header"></div>  
        <div class="info"><a href="/forgotpass"></i>Reset Password</a>
      </div>

  </main>

</div>

   


    
	<script src="script.js"></script>

  <script>
    // Fetch user data from the backend
  
    fetch('/user')
  .then(response => response.json())
  .then(data => {
    // Update the HTML with user data
    document.getElementById('fname').innerText = data.fname;
    document.getElementById('lname').innerText = data.lname;
    document.getElementById('fname2').innerText = data.fname;
    document.getElementById('lname2').innerText = data.lname;
    document.getElementById('email').innerText = data.email;
    document.getElementById('rollno').innerText = data.rollno;
    document.getElementById('address').innerText = data.address;
    document.getElementById('balance').innerText = data.balance + " POL";
    document.getElementById('balance2').innerText = data.balance + " POL";

    // Generate QR code with user's address or any other text
    new QRCode(document.getElementById('qrcode'), {
      text: data.address, // Replace this with the text you want to encode
      width: 128,  
      height: 128,  
    });
  })
  .catch(error => {
    console.error('Error fetching user data:', error);
  });
</script>

<script>
  document.getElementById('scanQrBtn').addEventListener('click', function () {
      // Open the QR scanner page
      const scannerPage = window.open('/qr-scanner', '_blank', 'width=400,height=400');

      // Listen for a message from the scanner page
      window.addEventListener('message', function (event) {
          if (event.origin === window.location.origin) { // Ensure the message is from the same origin
              const receiverName = event.data.receiverName; // Receiver name sent from the QR scanner page
              if (receiverName) {
                  // Redirect to /payment with the receiver's name
                  window.location.href = `/payment?receiver=${encodeURIComponent(receiverName)}`;
              }
          }
      });
  });
</script>


  </body>
</html>
